{% extends 'base.html.twig' %}
{% block body %}
    <div class="container">
        <div class="row">
            <div class="col-xs-12">
                <table id="table-clubs" class="table">
                    <thead>
                    <tr>
                        <th></th>
                        <th></th>
                        <th>Zawodnik 1</th>
                        <th>Zawodnik 2</th>
                    </tr>
                    </thead>
                </table>
            </div>
        </div>
    </div>
{% endblock %}
{% block javascripts %}
    {{ parent() }}
    <script>
        $(document).ready(function(){
            var t = $('#table-clubs').DataTable({
                "ajax": "{{ path('app_api_fight_list')}}",
                "columns": [
                    { data : null },
                    { mData : function (data){
                        var temp = (data['0'].youtube_id === null)  ?  '' : " <img class='youtube-icon' src='{{ asset('img/YouTube-icon-full_color.png') }}'></a>";

                            return  "<a href='"+ data['0']._self +"'>Szczegóły</a>" + temp;
                        }},
                    { mData : function (data){
                            return renderWDLDQ(data['0']) + '<br>' + record(data['0']) +
                                club(data['0']) + '<br>' + age(data['0']);
                        }},
                    { mData : function (data){
                            return renderWDLDQ(data['1']) + '<br>' + record(data['1']) +
                                 club(data['1']) + '<br>' + age(data['1']);
                        }},
                ],
                "language": {
                    "url": "//cdn.datatables.net/plug-ins/1.10.15/i18n/Polish.json"
                },
                "bPaginate": false,
                "dom": 'lifrtp'
            });

            t.on( 'order.dt search.dt', function () {
                t.column(0, {search:'applied', order:'applied'}).nodes().each( function (cell, i) {
                    cell.innerHTML = i+1;
                } );
            } ).draw();
        });

        function renderWDLDQ(data) {
            var temp = "<a href='"+ data.user_url +"'>" + data.name +' '+ data.surname + "</a> ";
            if (data.is_draw === '1') {
                temp += "<span class='label label-warning'>D</span>"
            }else if(data.is_disqualified === '1'){
                temp += "<span class='label label-dark'>DQ</span>";
            } else {
                temp += data.is_winner === '1' ? "<span class='label label-success'>W</span>" : "<span class='label label-danger'>L</span>";
            }

            return temp;
        }

        function record(data) {
            return '<span style="color: #5cb85c">'+ data.win +'</span> ' +
            '<span style="color: #f0ad4e">'+ data.draw +'</span> ' +
            '<span style="color: #d9534f">'+ data.lose +'</span>';
        }

        function club(data) {
            if(data.club_url === null){
                return '';
            }
            return "<br><a href='"+ data.club_url +"'>" + data.club_name +"</a>";
        }

        function age(data){
            if(data.age === null){
                return '';
            }
            var temp = data.age <= 18 ? '(Junior)' : '';
            return data.age + ' lat ' + temp;
        }
    </script>
{% endblock %}
