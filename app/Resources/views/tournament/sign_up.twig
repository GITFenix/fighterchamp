{% extends 'base.html.twig' %}
{% block body %}
    <div class="container-fluid" xmlns="http://www.w3.org/1999/html">
        <nav class="row navbar navbar-inverse navbar-admin">
            <h1 class=" col-xs-12 text-center text-uppercase">{{ tournament.name }}</h1>
            <div class="col-xs-12 col-md-10 col-md-offset-1">
                <ul class="nav navbar-nav nav-tabs nav-justified">
                    <li id="tournament_show"><a href="#">Info</a></li>
                    <li id="tournament_sign_ups"><a href="{{ path('tournament_sign_up', {'id': tournament.id}) }}">Zgłoszenia</a></li>
                    <li id="tournament_fights"><a href="#">Walki</a></li>
                    <li id="tournament_rules"><a href="#">Regulamin</a></li>
                    <li id="tournament_contact"><a href="#">Kontakt</a></li>
                </ul>
            </div>
        </nav>
    </div>
    <div class="main">
        <div class="container">
            <div class="row">
                <div class="col-xs-12" id="app">

                    {% if "now"|date('Y-m-d') <= tournament.signUpTill|date('Y-m-d') %}
                    <p class="text-center">Zgłoszenia przyjmowane są do {{ tournament.signUpTill | date('Y-m-d') }}
                        ({{ tournament.signUpTill |localizeddate('none', 'full', app.request.locale, null, 'cccc') }})</p>
                        {% if is_granted('ROLE_USER') %}
                            <p>
                                <small>Twoja data urodzenia to: {{ app.user.birthDay | date('Y-m-d') }}.
                                    W dniu turnieju {{ tournament.start | date('Y-m-d') }} będziesz miał {{ date_diff }}
                                    lat.
                                    Więc twoja kategoria wiekowa to - <b>{{ age }}</b></small>
                            </p>
                            <p>
                                <small>Twoja płeć to <b>{{ app.user.male ?  'mężczyzna' : 'kobieta' }}</b></small>
                            </p><br>
                        {% endif %}

                        {% if signUpTournament| length >= tournament.capacity %}
                            <p><strong>Limit miejsc został wyczerpany</strong></p>
                        {% endif %}

                    {% if not is_granted('ROLE_USER') %}
                        <p>Aby edytować / skasować swoje zgłoszenie na turniej musisz być zalogowany! &#8594; <a href="{{ path ('login') }}">Przejdź do strony logowania</a></p>
                    {% endif %}
                    {% if is_granted('ROLE_USER') and isUserRegister  %}
                    <p>Twoje zgłoszenie na turniej zostało zarejestrowane:</p>

                    {% include 'tournament/_twojeZgloszeniehtml.twig' with {signUpTournament : [isUserRegister]} only %}

                    {{ form_start(formDelete) }}
                    <button type="submit" class="btn btn-danger" formnovalidate >Skasuj moje zgłoszenie </button>
                    {{ form_end(formDelete)  }}
                    <br>
                    <button @click="show = !show" class="btn btn-primary align-left" >Edytuj</button> <br>

                    <div v-if="show" class="col-xs-12">
                        {% if app.user.pesel and (app.user.fatherName or app.user.motherName) %}
                            {% include 'tournament/_sign_up_form.html.twig' %}
                            {% else %}
                                <p>Aby wysłać swoje zgłoszenie na turniej musisz podać niezbędne dane do obowiązkowego
                                    uzbezpieczenia - numer pesel oraz imię Ojca albo Matki.
                                    <a href="{{ path ('my_profile') }}">Przejdź do Mój Profil</a> aby uzupełnić brakujące dane</p>
                        {% endif %}

                    </div>
                    {% if not isUserRegister.isPaid %}
                        <br>
                        <p><small>{{ include(template_from_string(tournament.paymentInfo)) }}</small></p>
                    {% endif %}
                </div>

                {% endif %}

                {% if is_granted('ROLE_USER') and not isUserRegister  %}

                    {% if app.user.pesel and (app.user.fatherName or app.user.motherName) %}
                        {% include 'tournament/_sign_up_form.html.twig' %}
                    {% else %}
                        <p>Aby wysłać swoje zgłoszenie na turniej musisz podać niezbędne dane do obowiązkowego
                            uzbezpieczenia - numer pesel oraz imię Ojca albo Matki.
                            <a href="{{ path ('my_profile') }}">Przejdź do Mój Profil</a> aby uzupełnić brakujące dane</p>
                    {% endif %}

                {% endif %}
                {% else %}
                    <p class="text-center">Termin przyjmowania zgłoszeń minął {{ tournament.signUpTill | date('Y-m-d') }}
                        ({{ tournament.signUpTill |localizeddate('none', 'full', app.request.locale, null, 'cccc') }})</p>

                {% if is_granted('ROLE_USER') and isUserRegister and tournament.end|date('Y-m-d') > "now"|date('Y-m-d')  %}
                    <p>Twoje zgłoszenie na turniej zostało zarejestrowane:</p>

                    {% include 'tournament/_twojeZgloszeniehtml.twig' with {signUpTournament : [isUserRegister]} only %}

                    {{ form_start(formDelete) }}
                    <button type="submit" class="btn btn-danger" formnovalidate >Skasuj moje zgłoszenie </button>
                    {{ form_end(formDelete)  }}
                    <small>Jeśli skasujesz swoje zgłoszenie, nie będziesz mógł ponownie się zapisać!</small>
                    {% endif %}



                {% endif %}
                <div class="col-xs-12">
                    <h3>
                        Liczba zapisanych: {{ signUpTournament| length }} / {{ tournament.capacity }}
                    </h3>
                    {% include 'tournament/_listaZapisanych.html.twig' %}
                </div>

            </div>
        </div>
    </div>
{% endblock %}

{% block javascripts %}

    {{ parent() }}
    <script>
        new Vue({
            el: '#app',
            delimiters: ['${', '}'],
            data: {
                show: false,
            },
        });

        $( "#tournament_rules" ).click(function() {
            $.ajax({
                type: 'GET',
                url: "{{ path('tournament_rules', {id: tournament.id}) }}",
                success: function (data) {
                    $(".main").html(data);
                }
            });
        });

        $( "#tournament_contact" ).click(function() {
            $.ajax({
                type: 'GET',
                url: "{{ path('tournament_contact', {id: tournament.id}) }}",
                success: function (data) {
                    $(".main").html(data);
                }
            });
        });




        $( "#tournament_show" ).click(function() {
            $.ajax({
                type: 'GET',
                url: "{{ path('tournament_show', {id: tournament.id}) }}",
                success: function (data) {
                    $(".main").html(data);
                }
            });
        });



        $( "#tournament_fights" ).click(function() {
            $.ajax({
                type: 'GET',
                url: "{{ path('tournament_fights', {id: tournament.id}) }}",
                success: function (data) {
                    $(".main").html(data);
                }
            });
        });

    </script>
{% endblock %}