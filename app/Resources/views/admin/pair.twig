{% extends 'base.html.twig' %}
{% block body %}
    {% include 'admin/base.html.twig' %}
    <div class="col-xs-12 col-md-10 col-md-offset-1">
        {{ form_start(form) }}
        {{ form_row(form.formula, { 'label': 'Klasa'} ) }}
        {{ form_row(form.weight, { 'label': 'Waga'} ) }}
        {% for signup in form.signuptournament %}
            <div class="col-xs-6">
                {{ form_errors(signup) }}
                {{ form_row(signup,{
                    'label': 'Zawodnik'
                }) }}
            </div>
        {% endfor %}

        <button type="submit" class="btn btn-primary" formnovalidate>Paruj</button>

        {{ form_end(form) }}

    </div>
    <div class="col-xs-12">
        <h3>Zawodnicy którzy są zgłoszeni do turnieju ale nie są jescze sparowani</h3>
        <h3>Ilość: {{ freeUsers| length }}</h3>
        <table id="table" class="table table-striped">
            <thead>
            <tr>
                <th>Nazwisko i Imię</th>
                <th>Płeć</th>
                <th>Formuła</th>
                <th>Kat. Wagowa</th>
                <th>Staż [miesiące]</th>
                <th>Wiek</th>
                <th>Klub</th>
            </tr>
            </thead>
            <tbody>
            {% for user in freeUsers %}
                <tr>
                    <td>
                        <a href="{{ path('user', {'id': user.User.id }) }}"> {{ user.User.surname }} {{ user.User.name }}</a>
                    </td>
                    <td> {{ user.User.male ?  'M' : 'K' }} </td>
                    <td> {{ user.formula }} </td>
                    <td> {{ user.weighted ?: user.weight }} </td>
                    <td> {{ user.trainingTime }} </td>
                    <td> {{ user.User.birthDay |getAge }} </td>
                    <td> {% if user.User.club %}
                        <a href="{{ path('club_show', {'id': user.User.club.id }) }}"> {{ user.User.getClub() }}</a>
                    </td>
                    {% endif %}
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script>

        $(document).ready(function () {

            $("#fight_signuptournament_1").val($("#fight_signuptournament_1 option:eq(1)").val());

            window.addEventListener("load", function(){
                $("select").change();
            }, false);

            $('select').on('change', function () {

                var selectFighter0 = $("#fight_signuptournament_0").find('option:selected').text();
                var selectFighter1 = $("#fight_signuptournament_1").find('option:selected').text();

                var formula = [findFormula(selectFighter0), findFormula(selectFighter1)].sort()[0];
                var weight = Math.max(findWeight(selectFighter0), findWeight(selectFighter1));

                var selectFormula = $("#fight_formula");
                var selectWeight= $("#fight_weight");

                selectFormula.find("option[value="+formula+"]").prop("selected", true);
                selectWeight.find("option[value="+weight+"]").prop("selected", true);

                var currValue = $(this).attr('data-value');
                var column = $(this).val();

                $(this).attr('data-value', column);
                $('select').find('[value="' + currValue + '"]').removeAttr('disabled');
                $('select').find('[value="' + currValue + '"]').css('display', 'inline-block');
                $('select').not(this).each(function () {
                    if (column === '') {
                        return;
                    }
                    $(this).find('[value="' + column + '"]').attr('disabled', 'disabled');
                    $(this).find('[value="' + column + '"]').css('display', 'none');
                });
            });

            function findFormula(string){
                return string.match(/(\bA\b)|(\bB\b)|(\bC\b)/)[0];
            }
            function findWeight(string) {
                return string.match(/(\d{2})kg/)[1];

            }

        });
    </script>
{% endblock %}